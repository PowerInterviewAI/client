# Auto-Update Feature

This document explains how the auto-update feature works and how to publish new releases.

## Overview

The Power Interview app supports automatic updates from GitHub Releases. The app checks for updates on launch and downloads them in the background, notifying users when an update is ready to install.

## Features

- **Automatic Check**: Checks for updates 3 seconds after app launch
- **Background Download**: Downloads updates automatically without blocking the app
- **User Notification**: Toast notifications inform users about update availability and progress
- **Manual Installation**: Users can choose when to restart and install the update
- **Graceful Error Handling**: Network failures and missing releases are handled silently
- **Logging**: All updater lifecycle events are logged for debugging

## User Flow

1. **App Launch**: Auto-updater checks for updates 3 seconds after the app starts
2. **Update Available**: If an update is found, a toast notification appears
3. **Downloading**: Download progress is shown in a loading toast
4. **Download Complete**: User is notified with options to:
   - **Restart Now**: Immediately quit and install the update
   - **Later**: Install update when the app is closed normally
5. **No Update**: If no update is available, no notification is shown

## Publishing Releases

To publish a new version that users can auto-update to:

### 1. Update Version

Update the version in `app/package.json`:

```json
{
  "version": "0.9.1"
}
```

### 2. Build the Application

```bash
cd app
npm run electron:build
```

This creates installers in the `../dist` directory.

### 3. Create a GitHub Release

1. Go to: https://github.com/PowerInterviewAI/power-interview-assistant/releases/new
2. Create a new tag matching the version (e.g., `v0.9.1`)
3. Fill in release notes
4. Upload the build artifacts from `dist/`:
   - `PowerInterview-Setup-{version}.exe` (Windows installer)
   - `latest.yml` (auto-updater metadata - generated by electron-builder)

### 4. Publish the Release

Once published, the auto-updater will detect the new version and offer it to users.

## Configuration

### GitHub Repository

The auto-updater is configured in `app/package.json`:

```json
{
  "build": {
    "publish": [
      {
        "provider": "github",
        "owner": "PowerInterviewAI",
        "repo": "power-interview-assistant",
        "releaseType": "release"
      }
    ]
  }
}
```

### Update Check Timing

The update check is triggered in `app/src/main/index.ts`:

```typescript
setTimeout(() => {
  autoUpdaterService.checkForUpdates().catch((error) => {
    console.error("[Main] Failed to check for updates:", error);
  });
}, 3000); // Wait 3 seconds after app launch
```

## Development Mode

Auto-updates are **disabled in development mode** to avoid interfering with development workflow. The check will be skipped when `NODE_ENV === 'development'`.

## Troubleshooting

### Updates Not Appearing

1. Check that the release is published (not draft)
2. Verify the version number is higher than the current version
3. Ensure `latest.yml` is uploaded to the release
4. Check the console logs for error messages

### Build Issues

If `latest.yml` is not generated:

- Ensure `electron-builder` is installed
- Check that the `publish` configuration is in `package.json`
- Run the build with: `npm run electron:build`

### GitHub API Rate Limits

If you encounter rate limits:

- Set the `GH_TOKEN` environment variable with a GitHub personal access token
- This increases the API rate limit

## Components

### Main Process

- **Service**: `app/src/main/services/auto-updater.service.ts`
  - Manages auto-updater lifecycle
  - Handles events and notifications
  - Provides logging

- **IPC Handlers**: `app/src/main/ipc/auto-updater.ts`
  - Exposes update functions to renderer
  - Handles check for updates
  - Handles quit and install

### Renderer Process

- **Hook**: `app/src/renderer/hooks/use-auto-updater.ts`
  - React hook for accessing update state
  - Provides functions to check for updates and install

- **Component**: `app/src/renderer/components/custom/update-notification.tsx`
  - Displays toast notifications for update events
  - Handles user interactions (restart now / later)

## Security

- Updates are downloaded over **HTTPS** from GitHub
- The auto-updater verifies the **signature** of downloaded files
- Only **official releases** from the configured repository are accepted
